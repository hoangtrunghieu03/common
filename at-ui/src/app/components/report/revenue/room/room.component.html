<div class="container-fluid">
  <div class="row">
      <div class="col-sm-12">
          <at-card>
              <h5>Doanh thu theo phòng</h5>
              <div class="validateSearch ">
                  <div class="block-search-filter row p-lg-0 m-b-15">
                      <div class="col-12 col-md-4 col-xl-3">
                          <ng-container *ngTemplateOutlet="filter"></ng-container>
                      </div>
                  </div>
              
                  <ng-container *ngTemplateOutlet="result"></ng-container>
              </div>
              <div class="order-graph sm-order-space m-b-30" *ngIf="roomReport && roomReport.length !== 0">
                  <div class="peity-chart-dashboard text-center chart-vertical-center">
                      <ng-container *ngIf="roomReport">
                          <canvas baseChart
                          height="300px"
                          [chartType]="'doughnut'"
                          [data]="serviceAttr.data"
                          [labels]="serviceAttr.label"
                          [options]="serviceAttr.option"
                          [colors]="serviceAttr.color"
                          [legend]="false">
                      </canvas>
                      </ng-container>
                      
                  </div>
              </div>
              <ng-template #checkLength>
                  <div class="d-flex flex-column align-items-center">
                      <div class="no-data"></div>
                      <span>Không có dữ liệu</span>
                  </div>
              </ng-template>
              <at-table-sumary
                  [tableData]="roomReport"
                  [columnDef]="columnDef"
                  [limit]="10"
                  [scrollbarH]="true">
              </at-table-sumary>
          </at-card>
      </div>
  </div>
</div>

<ng-template #filter>
  <at-filter-view (eventAddFilter)="onAddCondiotion()" [title]="'Hiển thị doanh thu theo'">
    <select class="form-control" [(ngModel)]="filterResult.condition" (change)="changeFilter()">
      <option *ngFor="let item of conditionData | keyvalue" [value]="item.key">{{item.value}}</option>
    </select>

    <ng-container *ngIf="filterResult.condition == 'room'">
      <select class="form-control mt-2" [(ngModel)]="filterResult.value">
        <option [ngValue]="null">Chọn điều kiện</option>
        <option *ngFor="let item of rooms" [value]="item._id">
          {{item.name}}
        </option>
      </select>
    </ng-container>

    <ng-container *ngIf="filterResult.condition == 'date'">
      <div class="row m-0">
        <div class="col-12 p-0">
          <span>Từ</span>
          <input class="form-control" type="date" required="" [(ngModel)]="filterResult.from" />
        </div>
        <div class="col-12 p-0">
          <span>Đến</span>
          <input class="form-control" type="date" required="" [(ngModel)]="filterResult.to" />
        </div>
      </div>
    </ng-container>

  </at-filter-view>
</ng-template>

<ng-template #result>
  <div class="render p-b-15" *ngIf="renderSelect?.length > 0">
    <span class="spanRender px-4 py-2 b-r-4 m-r-12 f-12" *ngFor="let item of renderSelect">
      <ng-container *ngIf="item.key =='room'">
        <span>{{item.firstCondition + ' là ' + getRoomId(item.secondCondition)}}</span>
      </ng-container>

      <ng-container *ngIf="item.key == 'date'">
        <span *ngIf="item.from && item.to">
          {{item.firstCondition +' '+ (item.from | date : 'dd/MM/yyyy') + ' - '
          + (item.to | date : 'dd/MM/yyyy')}}
        </span>
      </ng-container>
      <button (click)="onRemoveFilter(item)">X</button>
    </span>
  </div>
</ng-template>